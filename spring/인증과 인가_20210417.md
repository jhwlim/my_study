## 인증과 인가
- 인증
  - 식별 가능한 정보로 서비스에 등록된 유저의 신원을 입증하는 과정
- 인가
  - 권한에 대한 허가
  - 권한이 없다면 들어갈 수 없다.
  - 인증된 사용자에 대한 자원 접근 권한을 확인
- 웹에서의 인증과 인가
  - 인증 = 로그인
  - 인가 = 게시물을 작성할 수 있는 권한, 게시물을 조회할 수 있는 권한, 게시물을 수정할 수 있는 권한(다른 사람의 게시물을 수정할 수 있는 권한은 없다.)

### 웹에서의 인증과 인가 
- 서버와 클라이언트의 관계는 무상태성(Stateles)
- 무상태성 : 서버는 클라이언트의 요청들 사이에는 서로 연관이 없다고 가정하고 요청을 처리한다.
- 따라서, 매번 인증을 해야한다!
- 사용자의 편의성을 고려해서 인증을 처리하는 방법
1. 쿠키에 사용자의 정보를 저장하는 방법(클라이언트)
   - 단점 
     - 사용자의 정보가 raw하게 노출된다.
     - 클라이언트가 서버보다 상대적으로 보안이 취약
2. 서버에서 세션ID에 사용자의 정보를 담아서 응답의 헤더로 넘겨주고, 클라이언트에서 세션ID를 저장한다.
   - 장점 
     - 클라이언트의 raw한 데이터를 가지고 있지 않기 때문에 덜 위험하다.
     - 세션의 만료기간을 설정할 수 있다.
     - 세션에 대한 관리를 서버에서 하고 있기 때문에 탈취된 세션을 삭제하면 해당 세션을 사용할 수 없다.
   - 단점 
     - 서버가 여러개인 경우 로드밸런스가 생긴다. 이때, 세션을 생성한 서버가 아닌 다른 서버로 요청을 처리할 수 없다. (각 서버에서 세션을 관리하기 때문에 발생한 문제)
     - 로드 밸런스 : 부하를 고루 분담시켜 한 곳에 트래픽이 과다하게 집중되는 것을 막는 것
3. 세션 스토리지를 이용하여 세션을 한 곳에서 관리
   - 단점 
     - 클라이언트의 요청이 많아지면 하나의 세션 스토리지에서 감당할 수 없다.
4. 정보의 요청과 응답 안에 사용자의 상태를 담는다. (with Token)
   - JWT(JSON WEB TOKEN)
     - JWT는 해독이 쉽기 때문에 민감한 정보는 담지 않으며, 서버에서 잘 관리해줘야 한다.
   - 방식
        1. 서버는 클라이언트에게 JWT를 전달한다.
        2. 클라이언트에서는 JWT를 받고 저장하고, 서버에 요청을 보낼 때 JWT를 함께 보낸다.
        3. (1) 서버에서는 해당 토큰이 유효한지 유효성 검사를 진행하고, (2) JWT를 해독하여 사용자의 정보를 파악한다. (ex : 이름, 만료시기, 권한) 여러 개의 서버에서는 각자가 가진 해독키를 가지고 해독을 해서 인증할 수 있다.
   - 단점
     - 토큰을 탈취하면 그 토큰의 원래주인과 동일한 권한을 가지게 된다.
     - 따라서, 만료기간을 설정하는데, 불편하다!
     - 그래서, Access Token과 Refresh Token을 함께 사용한다.
   - 방식
     - 서버에서 Access Token과 Refresh Token을 한번에 생성한다. 이때, Access Token은 저장하지 않고, Refresh Token만 저장소에 저장한다. 그리고 한번에 응답의 헤더로 보내서 클라이언트는 2개의 Token을 모두 저장한다.
     - 클라이언트는 Access Token을 서버에 보내서 인증을 유지한다.
     - 각 토큰은 만료기간이 있으며, Access Token의 만료기간이 Refresh Token보다 짧다(?)
     - 만약 Access Token이 만료되었고, 사용자가 이것을 모르고 서버에 전달하게 되면 서버는 Refresh Token을 다시 요청한다(?)
     - 클라이언트가 만료된 Access Token과 Refresh Token을 다시 서버로 보내면 Refresh Token을 참고하여 DB를 조회해서 맞다면 Access Token을 새로 생성하여 클라이언트에게 보낸다.
     - 클라이언트는 갱신된 Access Token을 저장한다.
   - 장점
     - 토큰으로 관리하기 때문에 따로 세션을 둘 필요가 없다. → 효율성↑, DB접근X → 속도↑
   - 하지만 토큰도 관리하는 대상이기 때문에 보안에 신경을 써야한다.

   
### 원인
- 인증과 인가는 사용자의 정보를 가지고 있는 것을 의미한다. → 상태성을 가지고 있다.
- 클라이언트와 서버의 무상태성 vs 인증과 인가의 상태성 → 패러다임의 충돌!

### 기타 - 공부할 만한 키워드
- 보안
- OAuth : 생활코딩, 우테코
- JWT
- 인증 서버
- HTTPONLY
- SSL / TLS 1.3
- 해킹방법

### Reference
<https://www.youtube.com/watch?v=y0xMXlOAfss>